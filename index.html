<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Taman Suntex Bus Timetable</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#155dfc" />
  <style>
    body {
      font-family: "Poppins", sans-serif;
      margin: 0;
      padding: 20px;
      background: #f3f6fc;
      color: #333;
    }
    .container {
      max-width: 420px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 1.4rem;
      text-align: center;
      color: #155dfc;
      margin-bottom: 16px;
    }
    .controls {
      text-align: center;
      margin-bottom: 20px;
    }
    button {
      transform: scale(0.98);
      opacity: 0.9;
      background: #2f7a7a;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.25s ease;
      margin: 5px;
    }
    button:hover {
      background: #256b6b;
      opacity: 1;
    }
    .reset {
      background: #777;
    }
    .reset:hover {
      background: #555;
    }
    .card {
      margin-top: 10px;
      background: #fafafa;
      border-radius: 12px;
      padding: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .card h2 {
      text-align: center;
      color: #155dfc;
      font-size: 1.1rem;
      margin-bottom: 10px;
    }
    .time-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
    }
    .time-pill {
      background: #e3e9f7;
      border-radius: 8px;
      padding: 6px 10px;
      font-weight: 500;
      color: #333;
      font-size: 0.9rem;
      transition: all 0.3s;
    }
    .time-pill.highlight {
      background: #155dfc;
      color: #fff;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Taman Suntex Bus Service Timetable</h1>

    <!-- Countdown Timer -->
    <div id="nextBusTimer" style="
      text-align:center;
      font-weight:600;
      font-size:1.1rem;
      margin-bottom:10px;
      color:#155dfc;
    ">
      Checking next service...
    </div>

    <div class="controls">
      <button id="showRemaining">Show Remaining Services</button>
      <button class="reset" id="resetBtn">Show All</button>
    </div>

    <div class="card weekday">
      <h2>Weekday Schedule</h2>
      <div class="time-list">
        <span class="time-pill">6:00 am</span><span class="time-pill">6:30 am</span><span class="time-pill">7:00 am</span>
        <span class="time-pill">7:30 am</span><span class="time-pill">8:00 am</span><span class="time-pill">8:35 am</span>
        <span class="time-pill">9:05 am</span><span class="time-pill">9:40 am</span><span class="time-pill">10:15 am</span>
        <span class="time-pill">10:50 am</span><span class="time-pill">11:25 am</span><span class="time-pill">12:00 pm</span>
        <span class="time-pill">12:35 pm</span><span class="time-pill">1:10 pm</span><span class="time-pill">1:45 pm</span>
        <span class="time-pill">2:20 pm</span><span class="time-pill">2:55 pm</span><span class="time-pill">3:30 pm</span>
        <span class="time-pill">4:00 pm</span><span class="time-pill">4:30 pm</span><span class="time-pill">5:00 pm</span>
        <span class="time-pill">5:30 pm</span><span class="time-pill">6:00 pm</span><span class="time-pill">6:30 pm</span>
        <span class="time-pill">7:00 pm</span><span class="time-pill">7:30 pm</span><span class="time-pill">8:00 pm</span>
        <span class="time-pill">8:50 pm</span><span class="time-pill">9:40 pm</span>
        <span class="time-pill">10:30 pm</span><span class="time-pill">11:30 pm</span>
      </div>
    </div>

    <div class="card weekend">
      <h2>Weekend Schedule</h2>
      <div class="time-list">
        <span class="time-pill">6:00 am</span><span class="time-pill">6:30 am</span><span class="time-pill">7:00 am</span>
        <span class="time-pill">7:30 am</span><span class="time-pill">8:00 am</span><span class="time-pill">8:35 am</span>
        <span class="time-pill">9:05 am</span><span class="time-pill">9:40 am</span><span class="time-pill">10:15 am</span>
        <span class="time-pill">10:50 am</span><span class="time-pill">11:25 am</span><span class="time-pill">12:00 pm</span>
        <span class="time-pill">12:35 pm</span><span class="time-pill">1:10 pm</span><span class="time-pill">1:45 pm</span>
        <span class="time-pill">2:20 pm</span><span class="time-pill">2:55 pm</span><span class="time-pill">3:30 pm</span>
        <span class="time-pill">4:00 pm</span><span class="time-pill">4:30 pm</span><span class="time-pill">5:00 pm</span>
        <span class="time-pill">5:30 pm</span><span class="time-pill">6:00 pm</span><span class="time-pill">6:30 pm</span>
        <span class="time-pill">7:00 pm</span><span class="time-pill">7:30 pm</span>
        <span class="time-pill">8:30 pm</span><span class="time-pill">9:30 pm</span>
        <span class="time-pill">10:30 pm</span><span class="time-pill">11:30 pm</span>
      </div>
    </div>
  </div>

  <script>
    const showRemainingBtn = document.getElementById("showRemaining");
    const resetBtn = document.getElementById("resetBtn");
    const weekdayCard = document.querySelector(".weekday");
    const weekendCard = document.querySelector(".weekend");
    const nextBusTimer = document.getElementById("nextBusTimer");

    function convertToMinutes(timeStr) {
      const [time, modifier] = timeStr.split(" ");
      let [hours, minutes] = time.split(":").map(Number);
      if (modifier.toLowerCase() === "pm" && hours !== 12) hours += 12;
      if (modifier.toLowerCase() === "am" && hours === 12) hours = 0;
      return hours * 60 + (minutes || 0);
    }

    function updateNextBusTimer() {
      const now = new Date();
      const day = now.getDay();
      const currentMinutes = now.getHours() * 60 + now.getMinutes();
      const activeCard = (day === 0 || day === 6) ? weekendCard : weekdayCard;

      const times = Array.from(activeCard.querySelectorAll(".time-pill"));
      let nextBus = null;
      let nextBusTime = null;

      times.forEach(p => p.classList.remove("highlight"));

      for (const pill of times) {
        const timeVal = convertToMinutes(pill.textContent.trim());
        if (timeVal > currentMinutes) {
          nextBus = pill;
          nextBusTime = timeVal;
          break;
        }
      }

      if (!nextBus) {
        nextBusTimer.textContent = "No more buses today 🚍";
        return;
      }

      nextBus.classList.add("highlight");
      const minsLeft = nextBusTime - currentMinutes;
      const hours = Math.floor(minsLeft / 60);
      const mins = minsLeft % 60;
      nextBusTimer.textContent =
        hours > 0 ? `Next bus in ${hours} hr ${mins} min` : `Next bus in ${mins} min`;
    }

    function showRemaining() {
      const now = new Date();
      const day = now.getDay();
      const currentMinutes = now.getHours() * 60 + now.getMinutes();
      const activeCard = (day === 0 || day === 6) ? weekendCard : weekdayCard;
      const inactiveCard = (day === 0 || day === 6) ? weekdayCard : weekendCard;

      inactiveCard.style.display = "none";
      activeCard.style.display = "block";

      activeCard.querySelectorAll(".time-pill").forEach(pill => {
        const timeVal = convertToMinutes(pill.textContent.trim());
        pill.style.display = timeVal >= currentMinutes ? "inline-block" : "none";
      });

      updateNextBusTimer();
    }

    function resetTable() {
      document.querySelectorAll(".card").forEach(card => {
        card.style.display = "block";
        card.querySelectorAll(".time-pill").forEach(pill => pill.style.display = "inline-block");
      });
      nextBusTimer.textContent = "Checking next service...";
    }

    showRemainingBtn.addEventListener("click", showRemaining);
    resetBtn.addEventListener("click", resetTable);

    setInterval(updateNextBusTimer, 30000);
    updateNextBusTimer();

    // Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(reg => console.log('Service worker registered:', reg))
          .catch(err => console.error('Service worker failed:', err));
      });
    }
  </script>
</body>
</html>
