<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Taman Suntex Bus Timetable</title>

  <!-- PWA Meta -->
  <link rel="icon" href="bus-icon.png" />
  <meta name="theme-color" content="#155dfc" />
  <link rel="manifest" href="manifest.json" />

  <style>
    :root {
      --peak:#0066cc;
      --off1:#FFB302;
      --off2:#020B43;
      --off3:#000000;
      --bg:#f7f7f7;
      --card:#ffffff;
      --muted:#666;
      --gap:8px;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
    body{margin:16px;background:var(--bg);color:#111}
    .container{max-width:1000px;margin:0 auto;padding:16px}
    h1{font-size:1.25rem;margin:0 0 8px}
    .card{background:var(--card);border-radius:8px;padding:12px;box-shadow:0 1px 3px rgba(0,0,0,0.06);margin-bottom:16px}
    .periods{display:flex;flex-wrap:wrap;gap:var(--gap);margin-bottom:12px}
    .period{flex:1 1 140px;min-width:140px;padding:8px;border-radius:6px;color:#fff;font-weight:600;text-align:center;}
    .peak{background:var(--peak)}
    .off1{background:var(--off1)}
    .off2{background:var(--off2)}
    .off3{background:var(--off3)}
    table{width:100%;border-collapse:collapse;margin-top:6px}
    thead th{background:#eee;text-align:left;padding:8px;font-size:0.95rem}
    tbody td{padding:8px;border-top:1px solid #eee;vertical-align:top}
    .times{display:flex;flex-wrap:wrap;gap:6px}
    .time-pill{background:#f0f0f0;padding:6px 8px;border-radius:6px;font-size:0.95rem}
    .controls{display:flex;justify-content:center;gap:12px;margin-bottom:20px}
    button{
      background:#155dfc;
      color:#fff;
      border:none;
      border-radius:8px;
      padding:10px 14px;
      font-size:1rem;
      cursor:pointer;
      transition:background 0.25s ease;
    }
    button:active { transform: scale(0.90); opacity: 0.9; }
    button:hover{background:#689bff;}
    .reset{background:#525355;}
    .reset:hover{background:#9e9e9e;}
    @media(min-width:720px){ .period{flex:1 1 180px} }

    @media (max-width: 420px) {
      .periods {
        display: none !important;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Taman Suntex Bus Service Timetable</h1>

    <div class="controls">
      <button id="showRemaining">Show Remaining Services</button>
      <button class="reset" id="resetBtn">Show All</button>
    </div>

    <!-- MON–FRI -->
    <div class="card weekday">
      <h2>Monday – Friday</h2>
      <div class="periods">
        <div class="period peak">Peak 1<br><small>6:00 am – 8:59 am (every 30 min)</small></div>
        <div class="period off1">Off Peak 1<br><small>9:00 am – 3:59 pm (every 35 min)</small></div>
        <div class="period peak">Peak 2<br><small>4:00 pm – 7:59 pm (every 30 min)</small></div>
        <div class="period off2">Off Peak 2<br><small>8:00 pm – 9:59 pm (every 50 min)</small></div>
        <div class="period off3">Off Peak 3<br><small>10:00 pm – 12:00 am (every 60 min)</small></div>
      </div>
      <table>
        <thead><tr><th>Period</th><th>Departure Times</th></tr></thead>
        <tbody>
          <tr><td><strong>Peak 1</strong></td><td><div class="times">
            <span class="time-pill">6:00 am</span><span class="time-pill">6:30 am</span><span class="time-pill">7:00 am</span>
            <span class="time-pill">7:30 am</span><span class="time-pill">8:00 am</span><span class="time-pill">8:35 am</span>
          </div></td></tr>
          <tr><td><strong>Off Peak 1</strong></td><td><div class="times">
            <span class="time-pill">9:05 am</span><span class="time-pill">9:40 am</span><span class="time-pill">10:15 am</span>
            <span class="time-pill">10:50 am</span><span class="time-pill">11:25 am</span><span class="time-pill">12:00 pm</span>
            <span class="time-pill">12:35 pm</span><span class="time-pill">1:10 pm</span><span class="time-pill">1:45 pm</span>
            <span class="time-pill">2:20 pm</span><span class="time-pill">2:55 pm</span><span class="time-pill">3:30 pm</span>
          </div></td></tr>
          <tr><td><strong>Peak 2</strong></td><td><div class="times">
            <span class="time-pill">4:00 pm</span><span class="time-pill">4:30 pm</span><span class="time-pill">5:00 pm</span>
            <span class="time-pill">5:30 pm</span><span class="time-pill">6:00 pm</span><span class="time-pill">6:30 pm</span>
            <span class="time-pill">7:00 pm</span><span class="time-pill">7:30 pm</span>
          </div></td></tr>
          <tr><td><strong>Off Peak 2</strong></td><td><div class="times">
            <span class="time-pill">8:50 pm</span><span class="time-pill">9:40 pm</span>
          </div></td></tr>
          <tr><td><strong>Off Peak 3</strong></td><td><div class="times">
            <span class="time-pill">10:30 pm</span><span class="time-pill">11:30 pm</span>
          </div></td></tr>
        </tbody>
      </table>
    </div>

    <!-- WEEKEND -->
    <div class="card weekend">
      <h2>Saturday – Sunday & Public Holidays</h2>
      <div class="periods">
        <div class="period peak">Peak 1<br><small>6:00 am – 8:59 am (every 30 min)</small></div>
        <div class="period off1">Off Peak 1<br><small>9:00 am – 3:59 pm (every 35 min)</small></div>
        <div class="period peak">Peak 2<br><small>4:00 pm – 7:59 pm (every 30 min)</small></div>
        <div class="period off2">Off Peak 2<br><small>8:00 pm – 9:59 pm (every 60 min)</small></div>
        <div class="period off3">Off Peak 3<br><small>10:00 pm – 12:00 am (every 60 min)</small></div>
      </div>
      <table>
        <thead><tr><th>Period</th><th>Departure Times</th></tr></thead>
        <tbody>
          <tr><td><strong>Peak 1</strong></td><td><div class="times">
            <span class="time-pill">6:00 am</span><span class="time-pill">6:30 am</span><span class="time-pill">7:00 am</span>
            <span class="time-pill">7:30 am</span><span class="time-pill">8:00 am</span><span class="time-pill">8:35 am</span>
          </div></td></tr>
          <tr><td><strong>Off Peak 1</strong></td><td><div class="times">
            <span class="time-pill">9:05 am</span><span class="time-pill">9:40 am</span><span class="time-pill">10:15 am</span>
            <span class="time-pill">10:50 am</span><span class="time-pill">11:25 am</span><span class="time-pill">12:00 pm</span>
            <span class="time-pill">12:35 pm</span><span class="time-pill">1:10 pm</span><span class="time-pill">1:45 pm</span>
            <span class="time-pill">2:20 pm</span><span class="time-pill">2:55 pm</span><span class="time-pill">3:30 pm</span>
          </div></td></tr>
          <tr><td><strong>Peak 2</strong></td><td><div class="times">
            <span class="time-pill">4:00 pm</span><span class="time-pill">4:30 pm</span><span class="time-pill">5:00 pm</span>
            <span class="time-pill">5:30 pm</span><span class="time-pill">6:00 pm</span><span class="time-pill">6:30 pm</span>
            <span class="time-pill">7:00 pm</span><span class="time-pill">7:30 pm</span>
          </div></td></tr>
          <tr><td><strong>Off Peak 2</strong></td><td><div class="times">
            <span class="time-pill">8:30 pm</span><span class="time-pill">9:30 pm</span>
          </div></td></tr>
          <tr><td><strong>Off Peak 3</strong></td><td><div class="times">
            <span class="time-pill">10:30 pm</span><span class="time-pill">11:30 pm</span>
          </div></td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const showRemainingBtn = document.getElementById("showRemaining");
    const resetBtn = document.getElementById("resetBtn");
    const weekdayCard = document.querySelector(".weekday");
    const weekendCard = document.querySelector(".weekend");

    function convertToMinutes(timeStr) {
      const [time, modifier] = timeStr.split(" ");
      let [hours, minutes] = time.split(":").map(Number);
      if (modifier.toLowerCase() === "pm" && hours !== 12) hours += 12;
      if (modifier.toLowerCase() === "am" && hours === 12) hours = 0;
      return hours * 60 + (minutes || 0);
    }

    function showRemaining() {
      const now = new Date();
      const day = now.getDay();
      const currentMinutes = now.getHours() * 60 + now.getMinutes();
      const activeCard = (day === 0 || day === 6) ? weekendCard : weekdayCard;
      const inactiveCard = (day === 0 || day === 6) ? weekdayCard : weekendCard;

      inactiveCard.style.display = "none";
      activeCard.style.display = "block";

      activeCard.querySelectorAll(".time-pill").forEach(pill => {
        const timeVal = convertToMinutes(pill.textContent.trim());
        if (timeVal < currentMinutes) pill.style.display = "none";
      });
    }

    function resetTable() {
      document.querySelectorAll(".card").forEach(card => {
        card.style.display = "block";
        card.querySelectorAll(".time-pill").forEach(pill => pill.style.display = "inline-block");
      });
    }

    showRemainingBtn.addEventListener("click", showRemaining);
    resetBtn.addEventListener("click", resetTable);

    // ✅ Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(reg => console.log('Service worker registered:', reg))
          .catch(err => console.error('Service worker failed:', err));
      });
    }
  </script>
</body>
</html>
